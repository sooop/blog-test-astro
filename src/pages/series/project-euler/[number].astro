---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import PostNavigation from '../../../components/PostNavigation.astro';

export async function getStaticPaths() {
  const projectEulerPosts = await getCollection('project-euler');

  // Helper to extract filename without extension
  const getFileNumber = (filePath: string) => {
    return filePath.split('/').pop()?.replace('.md', '') ?? '';
  };

  // Sort by number ascending
  const sortedPosts = projectEulerPosts.sort((a, b) => {
    const numA = parseInt(getFileNumber(a.filePath ?? ''));
    const numB = parseInt(getFileNumber(b.filePath ?? ''));
    return numA - numB;
  });

  return sortedPosts.map((post, index) => ({
    params: { number: getFileNumber(post.filePath ?? '') },
    props: {
      post,
      prevPost: index > 0 ? sortedPosts[index - 1] : null,
      nextPost: index < sortedPosts.length - 1 ? sortedPosts[index + 1] : null,
    },
  }));
}

const { post, prevPost, nextPost } = Astro.props;
const { Content } = await render(post)

const getFileNumber = (filePath: string) => {
  return filePath.split('/').pop()?.replace('.md', '') ?? '';
};

const formatDate = (dateString?: string) => {
  if (!dateString) return null;
  const date = new Date(dateString);
  return date.toLocaleDateString('ko-KR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};
---

<BaseLayout title={post.data.title} currentPath={Astro.url.pathname}>
  <article class="max-w-4xl mx-auto px-6 py-12 md:py-16">
    <header class="mb-12">
      <h1 class="font-serif text-4xl md:text-5xl mb-4 text-foreground">
        {post.data.title}
      </h1>
      <div class="flex gap-4 text-sm text-muted-foreground">
        {post.data.published_date && (
          <time datetime={post.data.published_date}>
            {formatDate(post.data.published_date)}
          </time>
        )}
      </div>
    </header>

    <div class="prose prose-lg max-w-none">
      <Content />
    </div>

    <PostNavigation
      prevPost={prevPost ? { url: `/series/project-euler/${getFileNumber(prevPost.filePath ?? '')}`, title: prevPost.data.title } : null}
      nextPost={nextPost ? { url: `/series/project-euler/${getFileNumber(nextPost.filePath ?? '')}`, title: nextPost.data.title } : null}
      listUrl="/series/project-euler"
    />
  </article>
</BaseLayout>
